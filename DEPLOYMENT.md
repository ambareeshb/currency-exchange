# Render Deployment Guide

## Automatic Deployment with GitHub and Render

This guide shows how to deploy the Currency Exchange Admin App to Render with automatic deployments triggered by GitHub pushes to the main branch.

## Prerequisites

1. **GitHub Account** with your repository
2. **Render Account** (free tier available)
3. **Custom Domain** (optional)

## Step 1: Prepare Your Repository

### 1.1 Push Code to GitHub

```bash
# Initialize git repository (if not already done)
git init

# Add all files
git add .

# Commit changes
git commit -m "Initial commit: Currency Exchange Admin App"

# Add GitHub remote
git remote add origin https://github.com/yourusername/currency-exchange.git

# Push to main branch
git push -u origin main
```

### 1.2 Repository Structure

Ensure your repository has these files:
```
├── app.py                    # Main Flask application
├── migrations.py             # Database migrations
├── requirements.txt          # Python dependencies
├── render.yaml              # Render deployment configuration
├── .env.production          # Production environment template
├── templates/               # HTML templates
└── README.md               # Documentation
```

## Step 2: Create Render Configuration

### 2.1 Create `render.yaml`

Create this file in your repository root:

```yaml
services:
  - type: web
    name: currency-exchange
    env: python
    buildCommand: "pip install -r requirements.txt"
    startCommand: "gunicorn --bind 0.0.0.0:$PORT app:app"
    envVars:
      - key: FLASK_ENV
        value: production
      - key: DEBUG
        value: false
      - key: LOAD_SAMPLE_DATA
        value: false
      - key: SECRET_KEY
        generateValue: true
      - key: ADMIN_USERNAME
        value: admin
      - key: ADMIN_PASSWORD
        generateValue: true
      - key: DATABASE_URL
        fromDatabase:
          name: currency-exchange-db
          property: connectionString

databases:
  - name: currency-exchange-db
    databaseName: currency_exchange
    user: currency_user
```

### 2.2 Update `app.py` for Render

Ensure your app.py handles the PORT environment variable:

```python
if __name__ == '__main__':
    # Initialize database and run migrations
    init_db_and_migrations()
    
    # Get configuration from environment
    port = int(os.environ.get('PORT', 5001))
    debug = os.environ.get('DEBUG', 'false').lower() == 'true'
    
    app.run(debug=debug, port=port, host='0.0.0.0')
```

## Step 3: Deploy to Render

### 3.1 Connect GitHub Repository

1. **Sign up/Login to Render**: Go to [render.com](https://render.com)
2. **Connect GitHub**: Click "New +" → "Web Service"
3. **Select Repository**: Choose your currency-exchange repository
4. **Grant Permissions**: Allow Render to access your repository

### 3.2 Configure Web Service

#### Basic Settings:
- **Name**: `currency-exchange`
- **Environment**: `Python 3`
- **Region**: Choose closest to your users
- **Branch**: `main`
- **Build Command**: `pip install -r requirements.txt`
- **Start Command**: `gunicorn --bind 0.0.0.0:$PORT app:app`

#### Environment Variables:
```
FLASK_ENV=production
DEBUG=false
LOAD_SAMPLE_DATA=false
SECRET_KEY=[Auto-generated by Render]
ADMIN_USERNAME=admin
ADMIN_PASSWORD=[Set your secure password]
DATABASE_URL=[Auto-configured if using Render PostgreSQL]
```

### 3.3 Database Setup (Optional)

For production with PostgreSQL:

1. **Create Database**: In Render dashboard, click "New +" → "PostgreSQL"
2. **Configure Database**:
   - Name: `currency-exchange-db`
   - Database Name: `currency_exchange`
   - User: `currency_user`
3. **Connect to Web Service**: Add database URL to environment variables

## Step 4: Automatic Deployment Setup

### 4.1 Auto-Deploy Configuration

Render automatically deploys when you push to the connected branch:

1. **Auto-Deploy**: Enabled by default for main branch
2. **Build Triggers**: Pushes to main branch trigger new deployments
3. **PR Previews**: Optional preview deployments for pull requests

### 4.2 Deployment Workflow

```bash
# Make changes to your code
git add .
git commit -m "Update: your changes"

# Push to main branch (triggers automatic deployment)
git push origin main

# Render will automatically:
# 1. Pull latest code
# 2. Install dependencies
# 3. Run migrations
# 4. Deploy new version
```

## Step 5: Custom Domain Setup

### 5.1 Add Custom Domain in Render

1. **Go to Service Settings**: In your Render service dashboard
2. **Custom Domains**: Click "Add Custom Domain"
3. **Enter Domain**: `your-domain.com`
4. **SSL Certificate**: Render provides free SSL automatically

### 5.2 Configure DNS

#### Option 1: Using Cloudflare
```
Type: CNAME
Name: @
Content: your-app-name.onrender.com
TTL: Auto
```

#### Option 2: Using Domain Registrar
```
Type: CNAME
Host: @
Points to: your-app-name.onrender.com
TTL: 3600
```

#### Option 3: Using A Record
```
Type: A
Name: @
Content: [Render IP Address from dashboard]
TTL: 3600
```

## Step 6: Environment Management

### 6.1 Production Environment Variables

Set these in Render dashboard under "Environment":

```bash
# Required
FLASK_ENV=production
DEBUG=false
SECRET_KEY=[Generate secure key]
ADMIN_USERNAME=[Your admin username]
ADMIN_PASSWORD=[Your secure password]

# Optional
LOAD_SAMPLE_DATA=false
DATABASE_URL=[Auto-configured]
```

### 6.2 Generate Secure Values

```bash
# Generate SECRET_KEY
python3 -c "import secrets; print(secrets.token_hex(32))"

# Generate secure password
python3 -c "import secrets; print(secrets.token_urlsafe(16))"
```

## Step 7: Monitoring and Logs

### 7.1 View Deployment Logs

1. **Render Dashboard**: Go to your service
2. **Logs Tab**: View real-time deployment and application logs
3. **Events Tab**: See deployment history and status

### 7.2 Health Monitoring

Render automatically monitors your app:
- **Health Checks**: HTTP requests to your app
- **Auto-Restart**: If app becomes unresponsive
- **Metrics**: CPU, memory, and request metrics

## Step 8: CI/CD Best Practices

### 8.1 Branch Protection

Set up branch protection in GitHub:

```bash
# In GitHub repository settings:
# 1. Go to Settings → Branches
# 2. Add rule for main branch
# 3. Require pull request reviews
# 4. Require status checks
```

### 8.2 Environment-Specific Deployments

Create different environments:

```yaml
# render.yaml for staging
services:
  - type: web
    name: currency-exchange-staging
    env: python
    buildCommand: "pip install -r requirements.txt"
    startCommand: "gunicorn --bind 0.0.0.0:$PORT app:app"
    envVars:
      - key: FLASK_ENV
        value: staging
      - key: LOAD_SAMPLE_DATA
        value: true
```

## Step 9: Database Migrations

### 9.1 Automatic Migrations

Migrations run automatically on deployment:

```python
# In app.py
if __name__ == '__main__':
    # This runs on every deployment
    init_db_and_migrations()
    
    port = int(os.environ.get('PORT', 5001))
    app.run(host='0.0.0.0', port=port)
```

### 9.2 Manual Migration Commands

If needed, run migrations manually:

```bash
# In Render shell (if available)
python migrations.py
```

## Step 10: Troubleshooting

### 10.1 Common Issues

1. **Build Failures**:
   ```bash
   # Check requirements.txt
   # Ensure all dependencies are listed
   # Check Python version compatibility
   ```

2. **Database Connection**:
   ```bash
   # Verify DATABASE_URL environment variable
   # Check database service status
   # Review connection logs
   ```

3. **Environment Variables**:
   ```bash
   # Ensure all required variables are set
   # Check for typos in variable names
   # Verify secret values are generated
   ```

### 10.2 Debugging Steps

1. **Check Logs**: Review deployment and runtime logs
2. **Environment**: Verify all environment variables
3. **Dependencies**: Ensure requirements.txt is complete
4. **Database**: Check database connection and migrations

## Step 11: Security Checklist

- [ ] **Secure Admin Credentials**: Change default username/password
- [ ] **Strong Secret Key**: Generate cryptographically secure key
- [ ] **Environment Variables**: Never commit secrets to repository
- [ ] **HTTPS**: Render provides SSL automatically
- [ ] **Database Security**: Use Render PostgreSQL for production
- [ ] **Branch Protection**: Require PR reviews for main branch
- [ ] **Regular Updates**: Keep dependencies updated

## Quick Deployment Summary

1. **Push to GitHub**: `git push origin main`
2. **Connect to Render**: Link GitHub repository
3. **Configure Environment**: Set production variables
4. **Deploy**: Automatic deployment on push
5. **Custom Domain**: Add your domain in Render dashboard
6. **Monitor**: Use Render dashboard for logs and metrics

## Deployment Commands

```bash
# Initial setup
git add .
git commit -m "Initial deployment setup"
git push origin main

# Future deployments
git add .
git commit -m "Your update message"
git push origin main
# Render automatically deploys!

# Check deployment status
# Visit Render dashboard or your live URL
```

Your Currency Exchange Admin App will now automatically deploy to Render whenever you push changes to the main branch!